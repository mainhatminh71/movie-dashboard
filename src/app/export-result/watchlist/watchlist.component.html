<div class="watchlist-container">
  <div class="watchlist-header">
    <div class="header-content">
      <h1 class="page-title">My Watchlist</h1>
      <p class="page-subtitle">{{ watchList().length }} {{ watchList().length === 1 ? 'item' : 'items' }} saved</p>
    </div>
    <div class="header-actions">
      @if (watchList().length > 0) {
        <button 
          class="clear-watchlist-btn" 
          (click)="showClearConfirmDialog()"
          [attr.aria-label]="'Clear all watchlist items'"
          [attr.title]="'Clear all watchlist items'"
        >
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 6H5H21M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>Clear All</span>
        </button>
      }
      <div class="search-bar">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 17C13.4183 17 17 13.4183 17 9C17 4.58172 13.4183 1 9 1C4.58172 1 1 4.58172 1 9C1 13.4183 4.58172 17 9 17Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M19 19L14.65 14.65" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <input 
          type="text" 
          class="search-input" 
          placeholder="Search your watchlist..."
          [value]="searchQuery()"
          (input)="onSearchInput($event)"
          [attr.aria-label]="'Search watchlist'"
        />
        @if (searchQuery()) {
          <button class="clear-search-btn" (click)="clearSearch()" aria-label="Clear search" [attr.title]="'Clear search'">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        }
      </div>
    </div>
  </div>

  @if (filteredWatchList().length === 0) {
    <div class="empty-state">
      @if (searchQuery()) {
        <div class="empty-content">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 17C13.4183 17 17 13.4183 17 9C17 4.58172 13.4183 1 9 1C4.58172 1 1 4.58172 1 9C1 13.4183 4.58172 17 9 17Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M19 19L14.65 14.65" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <h2>No results found</h2>
          <p>Try adjusting your search query</p>
          <button class="clear-search-btn-large" (click)="clearSearch()" [attr.aria-label]="'Clear search'">Clear Search</button>
        </div>
      } @else {
        <div class="empty-content">
          <svg width="80" height="80" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 8V12M12 12L15 15M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <h2>Your watchlist is empty</h2>
          <p>Start adding movies and TV shows to your watchlist</p>
          <button class="browse-btn" (click)="navigateToDiscover()" [attr.aria-label]="'Browse discover page'">Browse Discover</button>
        </div>
      }
    </div>
  } @else {
    <div class="browse-section">
      <button class="browse-btn" (click)="navigateToDiscover()" [attr.aria-label]="'Browse discover page'">Browse to Add More</button>
    </div>
    <div class="watchlist-grid">
      @for (item of paginatedWatchList(); track item.id) {
        <div class="watchlist-card" (click)="navigateToDetails(item)">
          <div class="card-poster">
            <img 
              [src]="getImageUrl(item.poster_path, 'w300')" 
              [alt]="item.title + ' poster'"
              [attr.title]="item.title + ' poster'"
              loading="lazy"
              (error)="onImageError($event)"
            />
            <div class="card-overlay">
              <button 
                class="remove-btn" 
                (click)="removeFromWatchlist(item); $event.stopPropagation()"
                [attr.aria-label]="'Remove ' + item.title + ' from watchlist'"
                [attr.title]="'Remove ' + item.title + ' from watchlist'"
              >
                <span class="sr-only">Remove {{ item.title }} from watchlist</span>
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                  <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
          </div>
          <div class="card-info">
            <h3 class="card-title">{{ item.title }}</h3>
            <div class="card-meta">
              <span class="card-year">{{ getYear(item.release_date) }}</span>
              <span class="card-date">Added {{ getRelativeDate(item.addedAt) }}</span>
            </div>
          </div>
        </div>
      }
    </div>
    <div class="results-count">
      <p>Showing {{ paginatedWatchList().length }} of {{ filteredWatchList().length }} {{ filteredWatchList().length === 1 ? 'item' : 'items' }}</p>
    </div>
    
    @if (totalPages() > 1) {
      <div class="pagination-wrapper">
        <div class="pagination">
          <button 
            class="pagination-btn" 
            [class.disabled]="currentPage() === 1"
            (click)="goToPage(currentPage() - 1)"
            [disabled]="currentPage() === 1"
            [attr.aria-label]="'Previous page'"
            [attr.title]="'Previous page'"
          >
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 12L6 8L10 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          
          <div class="pagination-pages">
            @for (page of getPagesArray(); track page) {
              <button
                class="pagination-page"
                [class.active]="page === currentPage()"
                (click)="goToPage(page)"
                [attr.aria-label]="'Go to page ' + page"
                [attr.title]="'Go to page ' + page"
              >
                {{ page }}
              </button>
            }
          </div>
          
          <button 
            class="pagination-btn" 
            [class.disabled]="currentPage() === totalPages()"
            (click)="goToPage(currentPage() + 1)"
            [disabled]="currentPage() === totalPages()"
            [attr.aria-label]="'Next page'"
            [attr.title]="'Next page'"
          >
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M6 12L10 8L6 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
      </div>
    }
  }

  <!-- Clear Confirmation Dialog -->
  @if (showClearConfirm()) {
    <div class="modal-overlay" (click)="cancelClear()">
      <div class="modal-dialog" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2 class="modal-title">Clear Watchlist</h2>
          <button class="modal-close" (click)="cancelClear()" [attr.aria-label]="'Close dialog'" [attr.title]="'Close dialog'">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <p class="modal-message">
            Are you sure you want to clear your entire watchlist? This action cannot be undone.
          </p>
          <p class="modal-submessage">
            {{ watchList().length }} {{ watchList().length === 1 ? 'item' : 'items' }} will be removed.
          </p>
        </div>
        <div class="modal-actions">
          <button class="modal-btn cancel-btn" (click)="cancelClear()" [attr.aria-label]="'Cancel clearing watchlist'">
            Cancel
          </button>
          <button class="modal-btn confirm-btn" (click)="confirmClearWatchlist()" [attr.aria-label]="'Confirm clearing watchlist'">
            Clear Watchlist
          </button>
        </div>
      </div>
    </div>
  }
</div>
