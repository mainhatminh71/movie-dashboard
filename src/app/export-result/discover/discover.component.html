<div class="discover-container">
  <!-- Header Section -->
  <div class="discover-header">
    <h1 class="page-title">Discover Movies</h1>
    <p class="page-subtitle">Find your next favorite movie</p>
  </div>

  <!-- Search and Filters Section -->
  <div class="filters-section">
    <!-- Search Bar -->
    <div class="search-container">
      <div class="search-input-wrapper">
        <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M10.5 10.5L15.5 15.5M21 11C21 16.5228 16.5228 21 11 21C5.47715 21 1 16.5228 1 11C1 5.47715 5.47715 1 11 1C16.5228 1 21 5.47715 21 11Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <input 
          type="text" 
          class="search-input" 
          placeholder="Search for movies..."
          [value]="searchQuery()"
          (input)="onSearchInput($event)"
        />
        @if (searchQuery()) {
          <button class="clear-search-btn" (click)="clearFilters()" aria-label="Clear search">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        }
      </div>
    </div>

    <!-- Genre Filter Section -->
    <div class="genre-section">
      <label class="filter-label">Genres</label>
      <div class="genre-chips">
        @for (genre of allGenres(); track genre.id) {
          <button 
            class="genre-chip"
            [class.active]="selectedGenreIDs().includes(genre.id)"
            (click)="toggleGenre(genre.id)"
          >
            {{ genre.name }}
          </button>
        }
      </div>
    </div>

    <div class="filters-row">
      <div class="filter-group">
        <label class="filter-label" for="year-select">Year</label>
        <select 
          id="year-select"
          class="filter-select"
          [value]="selectedYear() || ''"
          (change)="onYearChange($any($event.target).value ? +$any($event.target).value : null)"
          aria-label="Filter by year"
        >
          <option value="">All Years</option>
          @for (year of getYearsList(); track year) {
            <option [value]="year">{{ year }}</option>
          }
        </select>
      </div>

      <!-- Rating Filter -->
      <div class="filter-group">
        <label class="filter-label" for="rating-slider">Minimum Rating</label>
        <div class="rating-filter">
          <input 
            id="rating-slider"
            type="range" 
            class="rating-slider"
            min="0" 
            max="10" 
            step="0.5"
            [value]="minRating()"
            (input)="onRatingChange(+$any($event.target).value)"
            aria-label="Minimum rating filter"
          />
          <div class="rating-value">
            @if (minRating() > 0) {
              <span>{{ minRating().toFixed(1) }} ‚≠ê</span>
            } @else {
              <span>Any</span>
            }
          </div>
        </div>
      </div>

      @if (hasActiveFilters()) {
        <button class="clear-filters-btn" (click)="clearFilters()">
          Clear All Filters
        </button>
      }
    </div>
  </div>

  <div class="results-section">
    @if (loading()) {
      <div class="loading-container">
        <div class="spinner"></div>
        <p class="loading-text">Loading movies...</p>
      </div>
    } @else if (error()) {
      <div class="error-container">
        <svg class="error-icon" width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 8V12M12 16H12.01M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <p class="error-message">{{ error() }}</p>
        <button class="retry-btn" (click)="loadMovies()">Try Again</button>
      </div>
    } @else if (filteredDiscoveredMovie().length === 0) {
      <div class="empty-container">
        <svg class="empty-icon" width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M4 6H20M4 12H20M4 18H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <p class="empty-message">No movies found</p>
        <p class="empty-submessage">Try adjusting your filters or search query</p>
        @if (hasActiveFilters()) {
          <button class="clear-filters-btn" (click)="clearFilters()">Clear Filters</button>
        }
      </div>
    } @else {
      <div class="movies-grid">
        @for (movie of filteredDiscoveredMovie(); track movie.id) {
          <div class="movie-card" (click)="navigateToMovieDetails(movie.id)">
            <div class="movie-poster">
              <img 
                [src]="getImageUrl(movie.poster_path, 'w300')" 
                [alt]="getImageAlt(movie.title)"
                [title]="movie.title + ' poster'"
                loading="lazy"
                (error)="onImageError($event)"
              />
              <div class="movie-overlay">
                <div class="movie-rating">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
                  </svg>
                  <span>{{ movie.vote_average.toFixed(1) }}</span>
                </div>
              </div>
            </div>
            <div class="movie-info">
              <h3 class="movie-title">{{ movie.title }}</h3>
              <p class="movie-year">{{ getYear(movie.release_date) }}</p>
            </div>
          </div>
        }
      </div>
      <div class="results-count">
        <p>Found {{ filteredDiscoveredMovie().length }} movie{{ filteredDiscoveredMovie().length !== 1 ? 's' : '' }}</p>
      </div>
    }
  </div>
</div>
