<div class="discover-container">
  <!-- Header Section -->
  <div class="discover-header">
    <h1 class="page-title">Discover</h1>
    <p class="page-subtitle">Find your next favorite {{ activeTab() === 'movies' ? 'movies' : 'TV show' }}</p>
  </div>

  <!-- Tabs -->
  <div class="tabs-container">
    <button 
      class="tab-btn"
      [class.active]="activeTab() === 'movies'"
      (click)="switchTab('movies')"
    >
      Movies
    </button>
    <button 
      class="tab-btn"
      [class.active]="activeTab() === 'tvshows'"
      (click)="switchTab('tvshows')"
    >
      TV Shows
    </button>
  </div>

  <!-- Search and Filters Section -->
  <div class="filters-section">
    <!-- Search Bar -->
    <div class="search-container">
      <label for="discover-search-input" class="sr-only">Search for {{ activeTab() === 'movies' ? 'movies' : 'TV shows' }}</label>
      <mat-form-field appearance="fill" class="search-field" [floatLabel]="'always'">
        <mat-label class="search-label" id="search-label-input">
          <span class="label-text">Search {{ activeTab() === 'movies' ? 'movies' : 'TV Shows' }}</span>
        </mat-label>
        <input 
          matInput
          id="discover-search-input"
          name="discover-search-input"
          type="text" 
          [value]="searchQuery()"
          (input)="onSearchInput($event)"
          (focus)="onSearchFocus()"
          (blur)="onSearchBlur()"
          [placeholder]="'Search ' + (activeTab() === 'movies' ? 'movies' : 'TV shows') + ' by title, genre...'"
          [attr.aria-label]="'Search for ' + (activeTab() === 'movies' ? 'movies' : 'TV shows')"
          [attr.aria-labelledby]="'search-label-input'"
          [attr.aria-describedby]="'search-hint-' + activeTab()"
          title="Search for {{ activeTab() === 'movies' ? 'movies' : 'TV shows' }}"
          autocomplete="off"
          class="search-input"
        />
        @if (searchQuery()) {
          <button 
            mat-icon-button 
            matSuffix 
            (click)="clearSearch()" 
            aria-label="Clear search"
            class="clear-search-btn"
          >
            <mat-icon>close</mat-icon>
          </button>
        }
        <mat-icon matPrefix class="search-prefix-icon">search</mat-icon>
        @if (!searchQuery()) {
          <mat-hint class="search-hint" [id]="'search-hint-' + activeTab()">Press Enter to search</mat-hint>
        } @else {
          <mat-hint class="search-hint" [id]="'search-hint-' + activeTab()">{{ filteredContent().length }} {{ activeTab() === 'movies' ? 'movie' : 'TV show' }}{{ filteredContent().length !== 1 ? 's' : '' }} found</mat-hint>
        }
      </mat-form-field>
    </div>

    <!-- Genre Filter Section -->
    <div class="genre-section">
      <label class="filter-label">Genres</label>
      <div class="genre-chips">
        @for (genre of allGenres(); track genre.id) {
          <app-filter-chip
        [label]="genre.name"
        [isActive]="selectedGenreIDs().includes(genre.id)"
        (clicked)="toggleGenre(genre.id)"
      />
        }
      </div>
    </div>

    <div class="filters-row">
      <div class="filter-group">
        <app-year-select
          [selectedYear]="selectedYear()"
          (yearChange)="onYearChange($event)"
        />
      </div>
    
      <div class="filter-group">
        <app-rating-slider
          [value]="minRating()"
          [min]="0"
          [max]="10"
          [step]="0.5"
          (valueChange)="onRatingChange($event)"
        />
      </div>
    
      @if (hasActiveFilters()) {
        <button mat-raised-button color="warn" (click)="clearFilters()">
          <mat-icon>clear_all</mat-icon>
          Clear All Filters
        </button>
      }
    </div>
  </div>

  <div class="results-section">
    @if (loading()) {
      <div class="loading-container">
        <mat-spinner diameter="60"></mat-spinner>
        <p class="loading-text">Loading {{ activeTab() === 'movies' ? 'movies' : 'TV shows' }}...</p>
      </div>
    } @else if (error()) {
      <div class="error-container">
        <mat-icon class="error-icon">error_outline</mat-icon>
        <p class="error-message">{{ error() }}</p>
        <button mat-raised-button color="primary" (click)="loadContent()">
          <mat-icon>refresh</mat-icon>
          Try Again
        </button>
      </div>
    } @else if (filteredContent().length === 0) {
      <div class="empty-container">
        <mat-icon class="empty-icon">search_off</mat-icon>
        <p class="empty-message">No {{ activeTab() === 'movies' ? 'movies' : 'TV shows' }} found</p>
        <p class="empty-submessage">Try adjusting your filters or search query</p>
        @if (hasActiveFilters()) {
          <button mat-raised-button color="warn" (click)="clearFilters()">
            <mat-icon>clear_all</mat-icon>
            Clear Filters
          </button>
        }
      </div>
    } @else {
      <div class="movies-grid">
        @for (item of filteredContent(); track item.id) {
          <app-movie-card 
            [movie]="item"
            [showRating]="true"
            size="medium"
            (cardClick)="navigateToDetails(item.id)"
          />
        }
      </div>
      <div class="results-count">
        <p>Found {{ filteredContent().length }} {{ activeTab() === 'movies' ? 'movie' : 'TV show' }}{{ filteredContent().length !== 1 ? 's' : '' }}</p>
      </div>
    }
  </div>
</div>
