<div class="tv-details-container">
  @if (loading()) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p class="loading-text">Loading TV show details...</p>
    </div>
  } @else if (error()) {
    <div class="error-container">
      <svg class="error-icon" width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 8V12M12 16H12.01M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <p class="error-message">{{ error() }}</p>
      @if (currentTVShowId()) {
        <button class="retry-btn" (click)="loadTVData(currentTVShowId()!)">Try Again</button>
      }
    </div>
  } @else if (tv()) {
    <div class="tv-hero" [style.background-image]="'url(' + getImageUrl(backdropPath(), 'w1280') + ')'">
      <div class="hero-overlay"></div>
      <button class="back-button-hero" (click)="goBack()" [attr.aria-label]="'Back to ' + (referrer() === 'discover' ? 'Discover' : 'Home')">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        <span>Back to {{ referrer() === 'discover' ? 'Discover' : 'Home' }}</span>
      </button>
      <div class="hero-content">
        <div class="tv-poster-wrapper">
          <img 
            [src]="getImageUrl(posterPath(), 'w500')" 
            [alt]="currentName() + ' poster'"
            [title]="currentName() + ' poster'"
            class="tv-poster"
            loading="eager"
            (error)="onImageError($event)"
          />
        </div>
        <div class="tv-info-header">
          <h1 class="tv-title">{{ currentName() }}</h1>
          <div class="tv-meta">
            <div class="rating-badge">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
              </svg>
              <span>{{ voteAverage() ? voteAverage().toFixed(1) : 'N/A' }}</span>
            </div>
            <span class="meta-separator">•</span>
            <span class="tv-year">{{ getYear(firstAirDate()) }}</span>
            @if (tv()?.number_of_seasons) {
              <span class="meta-separator">•</span>
              <span class="tv-seasons">{{ tv().number_of_seasons }} Season{{ tv().number_of_seasons !== 1 ? 's' : '' }}</span>
            }
            @if (tv()?.episode_run_time && tv().episode_run_time.length > 0) {
              <span class="meta-separator">•</span>
              <span class="tv-runtime">{{ tv().episode_run_time[0] }} min/ep</span>
            }
          </div>
          <div class="tv-genres">
            @for (genre of tv()?.genres; track genre.id) {
              <span class="genre-tag">{{ genre.name }}</span>
            }
          </div>
          @if (tv()?.status) {
            <div class="tv-status">
              <span class="status-badge" [class.ended]="tv().status === 'Ended'" [class.returning]="tv().status === 'Returning Series'">
                {{ tv().status }}
              </span>
            </div>
          }
          <div class="tv-actions">
            <button 
              class="watchlist-btn"
              [class.active]="isInWatchlist()"
              (click)="toggleWatchlist()"
              [attr.aria-label]="isInWatchlist() ? 'Remove from watchlist' : 'Add to watchlist'"
            >
              @if (isInWatchlist()) {
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z"/>
                </svg>
                <span>In Watchlist</span>
              } @else {
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
                </svg>
                <span>Add to Watchlist</span>
              }
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="tv-content">
      <div class="content-main">
        <section class="overview-section">
          <h2 class="section-title">Overview</h2>
          <p class="tv-overview">{{ overview() || 'No overview available.' }}</p>
        </section>

        @if (tv()?.number_of_episodes || tv()?.number_of_seasons) {
          <section class="show-info-section">
            <h2 class="section-title">Show Information</h2>
            <div class="show-info">
              @if (tv()?.number_of_seasons) {
                <div class="show-info-item">
                  <span class="show-info-label">Seasons</span>
                  <span class="show-info-value">{{ tv().number_of_seasons }}</span>
                </div>
              }
              @if (tv()?.number_of_episodes) {
                <div class="show-info-item">
                  <span class="show-info-label">Episodes</span>
                  <span class="show-info-value">{{ tv().number_of_episodes }}</span>
                </div>
              }
              @if (tv()?.episode_run_time && tv().episode_run_time.length > 0) {
                <div class="show-info-item">
                  <span class="show-info-label">Episode Runtime</span>
                  <span class="show-info-value">{{ tv().episode_run_time[0] }} min</span>
                </div>
              }
              @if (tv()?.first_air_date) {
                <div class="show-info-item">
                  <span class="show-info-label">First Air Date</span>
                  <span class="show-info-value">{{ getYear(tv().first_air_date) }}</span>
                </div>
              }
            </div>
          </section>
        }

        @if (cast().length > 0) {
          <section class="cast-section">
            <h2 class="section-title">Cast</h2>
            <div class="cast-grid">
              @for (actor of cast().slice(0, 12); track actor.id) {
                <div class="cast-card">
                  <div class="cast-image-wrapper">
                    <img 
                      [src]="getImageUrl(actor.profile_path, 'w185')" 
                      [alt]="actor.name"
                      [title]="actor.name"
                      class="cast-image"
                      loading="lazy"
                      (error)="onImageError($event)"
                    />
                  </div>
                  <div class="cast-info">
                    <h3 class="cast-name">{{ actor.name }}</h3>
                    <p class="cast-character">{{ actor.character }}</p>
                  </div>
                </div>
              }
            </div>
          </section>
        }

        @if (reviews().length > 0) {
          <section class="reviews-section">
            <h2 class="section-title">Reviews</h2>
            <div class="reviews-list">
              @for (review of reviews().slice(0, 5); track review.id) {
                <div class="review-card">
                  <div class="review-header">
                    <div class="review-author">
                      <div class="author-avatar">
                        @if (review.author_details?.avatar_path) {
                          <img 
                            [src]="getImageUrl(review.author_details.avatar_path, 'w45')" 
                            [alt]="review.author"
                            [title]="review.author"
                            (error)="onImageError($event)"
                          />
                        } @else {
                          <div class="avatar-placeholder">{{ review.author.charAt(0) }}</div>
                        }
                      </div>
                      <div class="author-info">
                        <h4 class="author-name">{{ review.author }}</h4>
                        @if (review.created_at) {
                          <p class="review-date">{{ getYear(review.created_at) }}</p>
                        }
                      </div>
                    </div>
                    @if (review.author_details?.rating) {
                      <div class="review-rating">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                          <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
                        </svg>
                        <span>{{ review.author_details.rating }}/10</span>
                      </div>
                    }
                  </div>
                  <p class="review-content">{{ review.content }}</p>
                </div>
              }
            </div>
          </section>
        }
      </div>
    </div>

    @if (similarTVShows().length > 0) {
      <section class="similar-tv-shows-section">
        <h2 class="section-title">Similar TV Shows</h2>
        <div class="similar-tv-shows-grid">
          @for (similarTV of similarTVShows().slice(0, 8); track similarTV.id) {
            <div class="similar-tv-show-card" (click)="navigateToTVDetails(similarTV.id)">
              <div class="similar-tv-show-poster">
                <img 
                  [src]="getImageUrl(similarTV.poster_path, 'w300')" 
                  [alt]="similarTV.name"
                  [title]="similarTV.name + ' poster'"
                  loading="lazy"
                  (error)="onImageError($event)"
                />
                <div class="similar-tv-show-overlay">
                  <div class="similar-tv-show-rating">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                      <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
                    </svg>
                    <span>{{ similarTV.vote_average.toFixed(1) }}</span>
                  </div>
                </div>
              </div>
              <div class="similar-tv-show-info">
                <h3 class="similar-tv-show-title">{{ similarTV.name }}</h3>
                <p class="similar-tv-show-year">{{ getYear(similarTV.first_air_date) }}</p>
              </div>
            </div>
          }
        </div>
      </section>
    }
  }
</div>
