<div class="watchlist-container">
  <div class="watchlist-header">
    <div class="header-content">
      <h1 class="page-title">My Watchlist</h1>
      <p class="page-subtitle">{{ watchList().length }} {{ watchList().length === 1 ? 'item' : 'items' }} saved</p>
    </div>
    <div class="header-actions">
      @if (watchList().length > 0) {
        <button 
          mat-raised-button
          color="warn"
          (click)="showClearConfirmDialog()"
          [attr.aria-label]="'Clear all watchlist items'"
          [attr.title]="'Clear all watchlist items'"
        >
          <mat-icon>delete_sweep</mat-icon>
          <span>Clear All</span>
        </button>
      }
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Search your watchlist...</mat-label>
        <input 
          matInput
          type="text" 
          [value]="searchQuery()"
          (input)="onSearchInput($event)"
          [attr.aria-label]="'Search watchlist'"
        />
        @if (searchQuery()) {
          <button mat-icon-button matSuffix (click)="clearSearch()" aria-label="Clear search">
            <mat-icon>close</mat-icon>
          </button>
        }
        <mat-icon matPrefix>search</mat-icon>
      </mat-form-field>
    </div>
  </div>

  @if (filteredWatchList().length === 0) {
    <div class="empty-state">
      @if (searchQuery()) {
        <div class="empty-content">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 17C13.4183 17 17 13.4183 17 9C17 4.58172 13.4183 1 9 1C4.58172 1 1 4.58172 1 9C1 13.4183 4.58172 17 9 17Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M19 19L14.65 14.65" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <h2>No results found</h2>
          <p>Try adjusting your search query</p>
          <button mat-raised-button (click)="clearSearch()" [attr.aria-label]="'Clear search'">Clear Search</button>
        </div>
      } @else {
        <div class="empty-content">
          <svg width="80" height="80" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 8V12M12 12L15 15M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <h2>Your watchlist is empty</h2>
          <p>Start adding movies and TV shows to your watchlist</p>
          <button mat-raised-button color="primary" (click)="navigateToDiscover()" [attr.aria-label]="'Browse discover page'">
            <mat-icon>explore</mat-icon>
            Browse Discover
          </button>
        </div>
      }
    </div>
  } @else {
    <div class="browse-section">
      <button mat-raised-button color="primary" (click)="navigateToDiscover()" [attr.aria-label]="'Browse discover page'">
        <mat-icon>add</mat-icon>
        Browse to Add More
      </button>
    </div>
    <div class="watchlist-grid">
      @for (item of paginatedWatchList(); track item.id) {
        <div class="watchlist-card" (click)="navigateToDetails(item)">
          <div class="card-poster">
            <img 
              [src]="getImageUrl(item.poster_path, 'w300')" 
              [alt]="item.title + ' poster'"
              [attr.title]="item.title + ' poster'"
              loading="lazy"
              (error)="onImageError($event)"
            />
            <div class="card-overlay">
              <button 
                mat-mini-fab
                color="warn"
                (click)="removeFromWatchlist(item); $event.stopPropagation()"
                [attr.aria-label]="'Remove ' + item.title + ' from watchlist'"
                [attr.title]="'Remove ' + item.title + ' from watchlist'"
              >
                <mat-icon>close</mat-icon>
              </button>
            </div>
          </div>
          <div class="card-info">
            <h3 class="card-title">{{ item.title }}</h3>
            <div class="card-meta">
              <span class="card-year">{{ getYear(item.release_date) }}</span>
              <span class="card-date">Added {{ getRelativeDate(item.addedAt) }}</span>
            </div>
          </div>
        </div>
      }
    </div>
    <div class="results-count">
      <p>Showing {{ paginatedWatchList().length }} of {{ filteredWatchList().length }} {{ filteredWatchList().length === 1 ? 'item' : 'items' }}</p>
    </div>
    
    @if (totalPages() > 1) {
      <div class="pagination-wrapper">
        <div class="pagination">
          <button 
            mat-icon-button
            [disabled]="currentPage() === 1"
            (click)="goToPage(currentPage() - 1)"
            [attr.aria-label]="'Previous page'"
            [attr.title]="'Previous page'"
          >
            <mat-icon>chevron_left</mat-icon>
          </button>
          
          <div class="pagination-pages">
            @for (page of getPagesArray(); track page) {
              <button
                mat-mini-fab
                [color]="page === currentPage() ? 'primary' : null"
                (click)="goToPage(page)"
                [attr.aria-label]="'Go to page ' + page"
                [attr.title]="'Go to page ' + page"
                class="pagination-page"
              >
                {{ page }}
              </button>
            }
          </div>
          
          <button 
            mat-icon-button
            [disabled]="currentPage() === totalPages()"
            (click)="goToPage(currentPage() + 1)"
            [attr.aria-label]="'Next page'"
            [attr.title]="'Next page'"
          >
            <mat-icon>chevron_right</mat-icon>
          </button>
        </div>
      </div>
    }
  }

</div>
