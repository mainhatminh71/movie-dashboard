import{a as f}from"./chunk-U33RXDTR.js";import{N as n,S as g,T as u,ma as i,qb as a,rb as c}from"./chunk-IC3UCBGN.js";var S=(()=>{class s{constructor(){this.document=u(f),this.localStorage=this.document.defaultView?.localStorage,this.WATCHLIST_KEY="tmdb_watchlist",this.watchListSignal=i([]),this.watchList=this.watchListSignal.asReadonly(),this.count=a(()=>this.watchList().length),this.loadFromStorage(),c(()=>{if(this.localStorage)try{this.localStorage.setItem(this.WATCHLIST_KEY,JSON.stringify(this.watchListSignal))}catch{console.log("Effect Storage said: mewmew")}}),typeof window<"u"&&window.addEventListener("storage",t=>{if(t.key===this.WATCHLIST_KEY&&t.newValue){let e=JSON.parse(t.newValue);this.watchListSignal.set(e)}})}getWatchList(){if(!this.localStorage)return[];try{let t=this.localStorage.getItem(this.WATCHLIST_KEY);return t?JSON.parse(t):[]}catch{console.log("LocalStorage said: mewmew")}return[]}checkMovie(t){return!a(()=>this.watchList().some(e=>e.id===t.id))}checkMovieById(t){return!a(()=>this.watchList().some(e=>e.id===t))}addMovie(t){this.watchListSignal.update(e=>{if(this.checkMovie(t))return e;let r={id:t.id,title:t.title,poster_path:t.poster_path,release_date:t.release_date||"",addedAt:new Date().toISOString()};return[...e,r]})}removeMovie(t){return this.watchListSignal.update(e=>e.filter(r=>r.id!==t.id))}clearWatchList(t){this.localStorage&&(this.watchListSignal.set([]),this.localStorage.removeItem(this.WATCHLIST_KEY))}saveWatchList(t){if(!(typeof localStorage>"u"))try{this.localStorage?.setItem(this.WATCHLIST_KEY,JSON.stringify(t))}catch{}}loadFromStorage(){if(this.localStorage)try{let t=this.localStorage.getItem(this.WATCHLIST_KEY);if(t){let e=JSON.parse(t);this.watchListSignal.set(e)}else this.watchListSignal.set([])}catch{console.log("Load From Storage said: Mewmew")}}static{this.\u0275fac=function(e){return new(e||s)}}static{this.\u0275prov=n({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();var M=(()=>{class s{setDiscoveredMovie(t){this.discoveredWatchListSignal.set(t)}setGenresSignal(t){this.discoveredGenres.set(t)}setLoading(t){this.loadingSignal.set(t)}setError(t){this.errorSignal.set(t)}constructor(t){this.storageService=t,this.watchListSignal=i([]),this.discoveredWatchListSignal=i([]),this.discoveredGenres=i([]),this.loadingSignal=i(!1),this.errorSignal=i(null),this.filteredMovies=a(()=>{let r=this.discoveredWatchListSignal(),l=this.searchQuery().toLowerCase().trim(),L=this.selectedGenreIDs(),h=this.selectedYear();return l&&(r=r.filter(o=>o.title.toLowerCase().trim().includes(l))),L.length>0&&(r=r.filter(o=>o.genre_ide?.some(d=>o.genre_ide?.includes(d)))),h&&(r=r.filter(o=>o.release_date?new Date(o.release_date).getFullYear()===h:!1)),r}),this.watchList=this.watchListSignal.asReadonly(),this.watchListLength=a(()=>this.watchList.length),this.isEmptyWatchList=a(()=>this.watchListLength()===0),this.loading=this.loadingSignal.asReadonly(),this.error=this.errorSignal.asReadonly(),this.genres=this.discoveredGenres.asReadonly(),this.searchQuery=i(""),this.selectedGenreIDs=i([]),this.selectedYear=i(null),this.currentMovieId=i(null),this.currentTitle=i(null),this.currentPoster=i(null),this.currentBackdrop=i(null),this.currentOverview=i(null),this.currentReleaseDate=i(null),this.voteAverage=i(null),this.currentMovieGenre=i(null);let e=t.getWatchList();this.watchListSignal.set(e),c(()=>{t.saveWatchList(this.watchList())})}checkCurrentMovieInWatchList(){let t=this.currentMovieId();return t?this.storageService.checkMovieById(t):!1}toggleWatchlist(t){t!=null&&this.storageService.addMovie(t)}clearFilter(){this.searchQuery.set(""),this.selectedGenreIDs.set([]),this.selectedYear.set(null),this.currentMovieId.set(null)}static{this.\u0275fac=function(e){return new(e||s)(g(S))}}static{this.\u0275prov=n({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();export{M as a};
